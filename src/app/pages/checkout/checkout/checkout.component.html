<section class="py-20 overflow-hidden">
  <div class="container px-8 overflow-hidden">
    <div class="grid lg:grid-cols-[60%_minmax(0,1fr)] gap-5">
      <div class="saved-adresses flex flex-col gap-[32px]">
        @for (address of useraddress; track address._id) {
        <div
          class="card bg-white p-4 rounded-[10px] flex items-center gap-[133px] shadow"
        >
          <div class="flex gap-8">
            <div class="input">
              <input type="radio" name="address" [checked]="checkedAddress" />
            </div>
            <div class="card-body flex flex-col gap-2">
              <h2 class="font-popins font-medium text-2xl leading-[32px]">
                {{ address.name }}
              </h2>
              <p class="font-popins font-normal text-base text-text">
                {{ address.details }}, {{ address.city }}
              </p>
              <p class="font-popins font-medium text-base text-text">
                <span> Contact - </span>
                <span class="font-normal"> {{ address.phone }} </span>
              </p>
            </div>
          </div>
          <div class="icons flex gap-4 self-center">
            <span class="text-main">
              <i class="fa-solid fa-user-pen"></i>
            </span>
            <div class="bg-[#D1D1D8] w-px h-5"></div>
            <button type="button" (click)="removeAddress(address._id)">
              <span class="text-main">
                <i class="fa-solid fa-trash"></i>
              </span>
            </button>
          </div>
        </div>

        }
        <!-- ============================ -->

        <div
          class="add-address flex - gap-4 border-b border-[#D1D1D8] pb-4 cursor-pointer"
          (click)="showModal()"
        >
          <span class="text-main">
            <span><i class="fa-solid fa-plus"></i></span>
          </span>
          <p class="font-popins font-medium text-base text-main">
            Add New Address
          </p>

          <!-- ================? -->
        </div>
        <div class="shipment-method">
          <h2 class="font-popins font-medium text-xl text-text">
            Shipment Method
          </h2>
          <div
            class="free-shipment flex justify-between items-center py-4 px-6 border-2 borer-[#D1D1D8] rounded-sm shadow-sm mt-6"
          >
            <div
              class="regular font-medium text-text text-base font-popins flex gap-3 items-center capitalize"
            >
              <input
                checked
                class="checked:text-main border rounded-full bg-white"
                type="radio"
              />
              <span>free</span>
              <p class="font-normal">Regular Shipment</p>
            </div>
            <div class="date">
              <p class="font-medium text-text text-base font-popins">
                {{ futureDate | date : "mediumDate" }}
              </p>
            </div>
          </div>
        </div>
        <div class="payment-methods">
          <h2 class="font-popins font-medium text-xl text-text">Payment</h2>
          <form
            class="bg-white mt-[8px] border-1 border-[ rgb(203, 207, 215)] rounded-md shadow"
          >
            <div class="flex justify-between items-center my-2 p-4 border-b">
              <div class="flex gap-4 items-center">
                <input
                  type="radio"
                  name="creditCard"
                  id="creditCard  "
                  #credit
                />
                <label for="creditCard">Debit/Credit Card</label>
              </div>
              <div class="icon text-main">
                <i class="fa-solid fa-credit-card"></i>
              </div>
            </div>
            <div class="flex justify-between items-center my-2 p-4">
              <div class="flex gap-4 items-center">
                <input type="radio" name="creditCard" id="cashOrder" #cash />
                <label for="cashOrder">Cash On Delivery</label>
              </div>
              <div class="icon text-main">
                <i class="fa-solid fa-wallet"></i>
              </div>
            </div>
          </form>

          <!-- <form class="pt-2 flex flex-col gap-6">
            <div class="name flex flex-col gap-3">
              <label
                for="name"
                class="font-popins font-medium text-base capitalize"
              >
                your name</label
              >
              <input
                type="text"
                id="name"
                placeholder="Enter Your Name"
                class="rounded-md border border-[#9D9DAA] py-3 px-6 bg-transparent"
              />
            </div>

            <div class="card flex flex-col gap-3">
              <label
                for="card"
                class="font-popins font-medium text-base capitalize"
              >
                card number</label
              >
              <input
                type="text"
                id="card"
                placeholder="Enter Your card Number "
                class="rounded-md border border-[#9D9DAA] py-3 px-6 bg-transparent"
              />
            </div>

            <div class="grid grid-cols-2 gap-[26px]">
              <div class="expire-date flex flex-col gap-3">
                <label
                  for="expireDate"
                  class="font-popins font-medium text-base capitalize"
                >
                  expire date</label
                >
                <input
                  type="text"
                  id="expireDate"
                  placeholder="Expire Date"
                  class="rounded-md border border-[#9D9DAA] py-3 px-6 bg-transparent"
                />
              </div>

              <div class="cvv flex flex-col gap-3">
                <div class="cvv-label flex items-center justify-between">
                  <label
                    for="Cvv"
                    class="font-popins font-medium text-base capitalize"
                  >
                    Cvv</label
                  >

                  <button
                    data-popover-target="popover-top"
                    data-popover-placement="top"
                    type="button"
                  >
                    <span
                      class="text-[#0000004D] size-[25px] text-[14px] rounded-full bg-transparent border-4 border-[#0000004D] flex justify-center items-center"
                    >
                      <i class="fa-solid fa-question"></i>
                    </span>
                  </button>

                  <div
                    data-popover
                    id="popover-top"
                    role="tooltip"
                    class="absolute z-10 invisible inline-block w-64 text-sm text-gray-500 transition-opacity duration-300 bg-white border border-gray-200 rounded-lg shadow-xs opacity-0 dark:text-gray-400 dark:border-gray-600 dark:bg-gray-800"
                  >
                    <div
                      class="px-3 py-2 bg-black text-white border-b border-gray-200 rounded-t-lg dark:border-gray-600 dark:bg-gray-700"
                    >
                      <h3 class="font-semibold text-white">info</h3>
                    </div>
                    <div class="px-3 py-2">
                      <p>
                        "The CVV is a 3-digit code on the back of your card
                        (4-digit for Amex)."
                      </p>
                    </div>
                    <div data-popper-arrow></div>
                  </div>
                </div>

                <input
                  type="password"
                  id="Cvv"
                  placeholder="CVV"
                  class="rounded-md border border-[#9D9DAA] py-3 px-6 bg-transparent"
                />
              </div>
            </div>
          </form> -->
        </div>
        <!-- =========== -->
      </div>

      <div
        class="order-summary flex flex-col gap-8 p-8 border border-[#D1D1D8] bg-white h-max"
      >
        <div class="order-info flex flex-col gap-6">
          <div
            class="price flex justify-between items-center font-popins font-normal text-base text-text"
          >
            <h3>price</h3>
            <span>
              {{
                (cartDetails.totalCartPrice ? cartDetails.totalCartPrice : 0)
                  | currency : "GBP"
              }}
            </span>
          </div>
          <div
            class="discount flex justify-between items-center font-popins font-normal text-base text-blue-600"
          >
            <h3>Discount</h3>
            <span>
              {{
                (cartDetails.totalCartPrice
                  ? cartDetails.totalCartPrice * 0.1
                  : 0
                ) | currency : "GBP"
              }}
            </span>
          </div>
          <div
            class="Shipping flex justify-between items-center font-popins font-normal text-base text-text"
          >
            <h3>Shipping</h3>
            <span class="text-main">free</span>
          </div>
          <div
            class="price flex justify-between items-center font-popins font-normal text-base text-text"
          >
            <h3>Coupon Applied</h3>
            <span>{{ 0.0 | currency : "GBP" }} </span>
          </div>
        </div>
        <div class="h-[1px] bg-[#D1D1D8]"></div>
        <div class="order-total flex flex-col gap-6">
          <div
            class="total flex justify-between items-center font-popins font-normal text-base text-text"
          >
            <h3>Total</h3>
            <span>
              {{
                cartDetails.totalCartPrice - cartDetails.totalCartPrice * 0.1
                  | currency : "GBP"
              }}
            </span>
          </div>
          <div
            class="total flex justify-between items-center font-popins font-normal text-base text-text"
          >
            <h3>Estimated Delivery by</h3>
            <span class="font-semibold">
              {{ futureDate | date : "fullDate" }}
            </span>
          </div>
          <div class="input-group relative">
            <input
              type="text"
              name=""
              id=""
              placeholder="Coupon Code"
              class="rounded-[10px] py-4 pr-2 pl-4 border border-[#C0C0C0] w-full"
            />
            <button
              class="rounded-[8px] bg-main text-white px-5 py-2 font-popins font-semibold text-base absolute right-[2%] top-1/2 -translate-y-1/2"
            >
              Apply
            </button>
          </div>
          <button
            (click)="submitForm()"
            class="bg-main rounded-[32px] py-4 font-popins font-semibold text-xl text-white"
          >
            Place order
          </button>
        </div>
      </div>
    </div>

    <!--? modal 1 -->
    <div
      (click)="hideModal($event)"
      #popupModal
      class="hidden overflow-y-auto bg-[#00000078] overflow-x-hidden fixed top-0 right-0 left-0 z-50 justify-center items-center w-full md:inset-0 max-h-full"
    >
      <div class="relative p-4 w-full max-w-[450px] shadow-xl bg-white mx-auto">
        <div class="relative bg-white rounded-lg dark:bg-gray-700">
          <button
            (click)="closeModal()"
            type="button"
            class="absolute top-3 end-2.5 text-gray-400 bg-transparent hover:bg-gray-200 hover:text-gray-900 rounded-lg text-sm w-8 h-8 ms-auto inline-flex justify-center items-center dark:hover:bg-gray-600 dark:hover:text-white"
          >
            <svg
              class="w-3 h-3"
              aria-hidden="true"
              xmlns="http://www.w3.org/2000/svg"
              fill="none"
              viewBox="0 0 14 14"
            >
              <path
                stroke="currentColor"
                stroke-linecap="round"
                stroke-linejoin="round"
                stroke-width="2"
                d="m1 1 6 6m0 0 6 6M7 7l6-6M7 7l-6 6"
              />
            </svg>
            <span class="sr-only">Close modal</span>
          </button>
          <form [formGroup]="address" (ngSubmit)="submitAddressForm()">
            <div class="p-4 md:p-5">
              <div class="name flex flex-col gap-3 my-3">
                <label
                  for="name"
                  class="font-popins font-medium text-base capitalize"
                  [class]="{
                    'text-red-900':address.get('name')?.invalid && address.get('name')?.touched,
                  }"
                >
                  Your name</label
                >
                <input
                  formControlName="name"
                  type="text"
                  id="name"
                  placeholder="Enter Your Name"
                  class="rounded-md border py-3 px-6 bg-transparent border-gray-300 shadow-sm focus:border-indigo-300 focus:ring focus:ring-indigo-200 focus:ring-opacity-50"
                  [class]="{
                    
                    'focus:border-red-500':address.get('name')?.invalid && address.get('name')?.touched,
                    'border-red-500':address.get('name')?.invalid && address.get('name')?.touched,
                    'text-red-900':address.get('name')?.invalid && address.get('name')?.touched,
                    'focus:ring-red-500':address.get('name')?.invalid && address.get('name')?.touched,
                    
                  }"
                />

                @if (address.get("name")?.errors &&
                address.get("name")?.touched) {
                <div
                  class="p-4 mb-4 text-sm text-red-800 rounded-lg bg-red-50 dark:bg-gray-800 dark:text-red-400"
                  role="alert"
                >
                  "Please enter a valid Name. This field is required."
                </div>
                }
              </div>
              <div class="address flex flex-col gap-3 my-3">
                <label
                  [class]="{
                  'text-red-900':address.get('details')?.invalid && address.get('details')?.touched,
                }"
                  for="details"
                  class="font-popins font-medium text-base capitalize"
                >
                  Address line 1</label
                >
                <input
                  [class]="{
                    
                  'focus:border-red-500':address.get('details')?.invalid && address.get('details')?.touched,
                  'border-red-500':address.get('details')?.invalid && address.get('details')?.touched,
                  'text-red-900':address.get('details')?.invalid && address.get('details')?.touched,
                  'focus:ring-red-500':address.get('details')?.invalid && address.get('details')?.touched,
                  
                }"
                  formControlName="details"
                  type="text"
                  id="details"
                  placeholder="Enter Your Address "
                  class="rounded-md border py-3 px-6 bg-transparent border-gray-300 shadow-sm focus:border-indigo-300 focus:ring focus:ring-indigo-200 focus:ring-opacity-50"
                />

                @if (address.get("details")?.errors &&
                address.get("details")?.touched) {
                <div
                  class="p-4 mb-4 text-sm text-red-800 rounded-lg bg-red-50 dark:bg-gray-800 dark:text-red-400"
                  role="alert"
                >
                  "Please enter a valid address. This field is required."
                </div>
                }
              </div>

              <div class="city flex flex-col gap-3 my-3">
                <label
                  for="city"
                  class="font-popins font-medium text-base capitalize"
                  [class]="{
                    'text-red-900':address.get('city')?.invalid && address.get('city')?.touched,
                  }"
                >
                  City</label
                >
                <input
                  formControlName="city"
                  type="text"
                  id="city"
                  placeholder="Enter City Were You Born "
                  class="rounded-md border py-3 px-6 bg-transparent border-gray-300 shadow-sm focus:border-indigo-300 focus:ring focus:ring-indigo-200 focus:ring-opacity-50"
                  [class]="{
                    
                    'focus:border-red-500':address.get('city')?.invalid && address.get('city')?.touched,
                    'border-red-500':address.get('city')?.invalid && address.get('city')?.touched,
                    'text-red-900':address.get('city')?.invalid && address.get('city')?.touched,
                    'focus:ring-red-500':address.get('city')?.invalid && address.get('city')?.touched,
                    
                  }"
                />

                @if (address.get("city")?.errors &&
                address.get("city")?.touched) {
                <div
                  class="p-4 mb-4 text-sm text-red-800 rounded-lg bg-red-50 dark:bg-gray-800 dark:text-red-400"
                  role="alert"
                >
                  "City is required. Please enter a valid city to proceed."
                </div>
                }
              </div>

              <div class="phone flex flex-col gap-3 my-3">
                <label
                  for="phone"
                  class="font-popins font-medium text-base capitalize"
                  [class]="{
                    'text-red-900':address.get('phone')?.invalid && address.get('phone')?.touched,
                  }"
                >
                  phone</label
                >
                <input
                  formControlName="phone"
                  [class]="{
                    
                    'focus:border-red-500':address.get('phone')?.invalid && address.get('phone')?.touched,
                    'border-red-500':address.get('phone')?.invalid && address.get('phone')?.touched,
                    'text-red-900':address.get('phone')?.invalid && address.get('phone')?.touched,
                    'focus:ring-red-500':address.get('phone')?.invalid && address.get('phone')?.touched,
                    
                  }"
                  type="text"
                  id="phone"
                  placeholder="Enter Your Phone "
                  class="rounded-md border py-3 px-6 bg-transparent border-gray-300 shadow-sm focus:border-indigo-300 focus:ring focus:ring-indigo-200 focus:ring-opacity-50"
                />

                @if (address.get("phone")?.errors &&
                address.get("phone")?.touched) {
                <div
                  class="p-4 mb-4 text-sm text-red-800 rounded-lg bg-red-50 dark:bg-gray-800 dark:text-red-400"
                  role="alert"
                >
                  @if ((address.get("phone")?.getError("required"))) { "Phone is
                  required. Please enter a valid Phone Number to proceed."
                  }@else if ((address.get("phone")?.getError("pattern"))) {
                  "Invalid phone number. Please enter a valid Egyptian number
                  starting with 010, 011, 012, or 015, followed by 8 digits." }
                </div>
                }
              </div>

              <div class="grid grid-cols-2">
                <div class="flex items-center mb-4">
                  <input
                    formControlName="addressType"
                    [class]="{
                    
                      'focus:border-red-500':address.get('addressType')?.invalid && address.get('addressType')?.touched,
                      'border-red-500':address.get('addressType')?.invalid && address.get('addressType')?.touched,
                      'text-red-900':address.get('addressType')?.invalid && address.get('addressType')?.touched,
                      'focus:ring-red-500':address.get('addressType')?.invalid && address.get('addressType')?.touched,
                      
                    }"
                    id="addressType"
                    type="radio"
                    name="addressType"
                    value="home"
                    class="w-4 h-4 border-gray-300 focus:ring-2 focus:ring-blue-300 dark:focus:ring-blue-600 dark:focus:bg-blue-600 dark:bg-gray-700 dark:border-gray-600"
                  />
                  <label
                    for="addressType"
                    class="block ms-2 text-sm font-medium text-gray-900 dark:text-gray-300"
                  >
                    Home
                  </label>
                </div>

                <div class="flex items-center mb-4">
                  <input
                    formControlName="addressType"
                    id="addressType"
                    type="radio"
                    name="addressType"
                    value="Work"
                    class="w-4 h-4 border-gray-300 focus:ring-2 focus:ring-blue-300 dark:focus:ring-blue-600 dark:focus:bg-blue-600 dark:bg-gray-700 dark:border-gray-600"
                    [class]="{
                    
                      'focus:border-red-500':address.get('addressType')?.invalid && address.get('addressType')?.touched,
                      'border-red-500':address.get('addressType')?.invalid && address.get('addressType')?.touched,
                      'text-red-900':address.get('addressType')?.invalid && address.get('addressType')?.touched,
                      'focus:ring-red-500':address.get('addressType')?.invalid && address.get('addressType')?.touched,
                      
                    }"
                  />
                  <label
                    for="addressType"
                    class="block ms-2 text-sm font-medium text-gray-900 dark:text-gray-300"
                  >
                    Work
                  </label>
                </div>

                @if (address.get("addressType")?.errors &&
                address.get("addressType")?.touched) {
                <div
                  class="p-4 mb-4 text-sm text-red-800 rounded-lg bg-red-50 dark:bg-gray-800 dark:text-red-400"
                  role="alert"
                >
                  "Please provide a valid home or work address. This field is
                  required."
                </div>
                }
              </div>

              <button
                [class.bg-gray-400]="address.invalid"
                [disabled]="address.invalid"
                type="submit"
                class="text-white capitalize bg-blue-600 hover:bg-blue-800 hover:disabled:bg-gray-500 focus:ring-4 focus:outline-none focus:ring-blue-300 dark:focus:ring-red-800 font-medium rounded-lg text-sm inline-flex items-center px-5 py-2.5 text-center"
              >
                Add Address
              </button>
              <button
                (click)="closeModal()"
                type="button"
                class="py-2.5 px-5 capitalize ms-3 text-sm font-medium text-gray-900 focus:outline-none bg-white rounded-lg border border-gray-200 hover:bg-gray-100 hover:text-red-700 focus:z-10 focus:ring-4 focus:ring-gray-100 dark:focus:ring-gray-700 dark:bg-gray-800 dark:text-gray-400 dark:border-gray-600 dark:hover:text-white dark:hover:bg-gray-700"
              >
                cancel
              </button>
            </div>
          </form>
        </div>
      </div>
    </div>
  </div>
</section>
